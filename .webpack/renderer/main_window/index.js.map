{"version":3,"file":"main_window/index.js","mappings":"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","sources":["webpack://malcolm-app/./windows/controls.js"],"sourcesContent":["const audioCancelDuration = 1000;\r\n\r\nconst audio = (_ => {\r\n    let player = null;\r\n    let cancelTimeoutId = null;\r\n\r\n    let _public = {};\r\n\r\n    _public.play = src => {\r\n        if (player) {\r\n            player.stop();\r\n        }\r\n\r\n        if (cancelTimeoutId) {\r\n            clearTimeout(cancelTimeoutId);\r\n        }\r\n\r\n        player = new Howl({ src });\r\n        player.play();\r\n    }\r\n\r\n    _public.cancel = _ => {\r\n        console.log(player);\r\n        if (!player) {\r\n            return;\r\n        }\r\n\r\n        player.fade(1, 0, audioCancelDuration);\r\n\r\n        cancelTimeoutId = setTimeout(_ => {\r\n            if (player) {\r\n                player.stop();\r\n            }\r\n        }, 5000);\r\n    }\r\n\r\n    return _public;\r\n})();\r\n\r\nconst details = (_ => {\r\n    let _public = {};\r\n\r\n    _public.update = _ => {\r\n        let result = {};\r\n\r\n        $('input, textarea').each((index, element) => {\r\n            result[$(element).attr('id')] = $(element).val();\r\n        });\r\n\r\n        api.sendMessage('detailsUpdated', JSON.stringify(result));\r\n    }\r\n\r\n    _public.add = ({ key, index } = {}) => {\r\n        if (typeof key === 'undefined') {\r\n            key = `custom-${index}`;\r\n        }\r\n\r\n        if (typeof index === 'undefined') {\r\n            index = parseInt(key.substring(7));\r\n        }\r\n\r\n        $('#add-markdown').before($.parseHTML(`\r\n            <div class=\"markdown-container custom-markdown\">\r\n                <div class=\"markdown-header\">\r\n                    <label for=\"${key}\">Custom Text</label>\r\n                    <button class=\"remove-markdown\">Remove</button>\r\n                    <button class=\"markdown-show\">Show</button>\r\n                </div>\r\n                <textarea id=\"${key}\" rows=\"4\" placeholder=\"Custom markdown\"></textarea>\r\n            </div>\r\n        `));\r\n    }\r\n\r\n    return _public;\r\n})();\r\n\r\nfunction hidePanels() {\r\n    $('.panel-full').hide();\r\n    $('.header-tab').removeClass('selected');\r\n}\r\n\r\nasync function init() {\r\n    $(document).on('click', '.header-tab', event => {\r\n        hidePanels();\r\n\r\n        const $target = $(event.target);\r\n        $(`#panel-${$target.attr ('data-panel')}`).show();\r\n        $target.addClass('selected');\r\n    });\r\n\r\n    $(document).on('click', '.clear', event => {\r\n        const type = $(event.target).attr('data-type');\r\n\r\n        api.sendMessage('clear', type);\r\n        audio.cancel();\r\n    });\r\n\r\n    $(document).on('click', '#clear-sfx', _ => {\r\n        console.log('clearing sfx');\r\n        audio.cancel();\r\n    });\r\n\r\n    // local interaction\r\n    $(document).on('click', '.video-button', event => {\r\n        api.sendMessage('playVideo', $(event.currentTarget).attr('data-url'));\r\n    });\r\n\r\n    $(document).on('click', '.markdown-show', event => {\r\n        let siblings = $(event.target).parent().siblings();\r\n        siblings.each((index, sibling) => {\r\n            api.sendMessage('showText', $(sibling).val());\r\n        });\r\n    });\r\n\r\n    $(document).on('click', '#add-markdown', _ => {\r\n        let index = $('.custom-markdown').length;\r\n\r\n        details.add({ index });\r\n    });\r\n\r\n    $(document).on('click', '.remove-markdown', event => {\r\n        $(event.target).closest('.markdown-container').remove();\r\n    });\r\n\r\n    $(document).on('click', '.image-button', event => {\r\n        console.log('image clicked');\r\n        api.sendMessage('imageClicked', $(event.currentTarget).attr('data-url'));\r\n    });\r\n\r\n    $(document).on('click', '.sfx-button', event => {\r\n        const src = $(event.currentTarget).attr('data-url');\r\n        audio.play(src);\r\n    });\r\n\r\n    $(document).on('keydown', event => {\r\n        const num = parseInt(event.key);\r\n\r\n        if (isNaN(num)) {\r\n            return;\r\n        }\r\n\r\n        if (num > $('.sfx-button').length) {\r\n            return;\r\n        }\r\n\r\n        new Howl({\r\n            src: [$('.sfx-button').eq(num - 1).attr('data-url')]\r\n        }).play();\r\n    });\r\n\r\n    $(document).on('keyup', 'input, textarea', _ => {\r\n        details.update();\r\n    });\r\n\r\n    // api events\r\n    api.onListFiles((files) => {\r\n        for (let i = 0; i < files.videos.length; i++) {\r\n            const video = files.videos[i];\r\n            console.log(video);\r\n\r\n            $('#video-buttons').append($.parseHTML(`\r\n                <div class=\"video-button media-button\" data-url=\"${video.url}\">\r\n                    <video class=\"media-preview\" src=\"${video.url}#t=5\"></video>\r\n                    <p>${video.name}</p>\r\n                </div>\r\n            `));\r\n        }\r\n\r\n        for (let i = 0; i < files.images.length; i++) {\r\n            const image = files.images[i];\r\n\r\n            $('#image-buttons').append($.parseHTML(`\r\n                <div class=\"image-button media-button\" data-url=\"${image.url}\">\r\n                    <img class=\"media-preview\" src=\"${image.url}\">\r\n                    <p>${image.name}</p>\r\n                </div>\r\n            `));\r\n        }\r\n\r\n        for (let i = 0; i < files.sfx.length; i++) {\r\n            const sfx = files.sfx[i];\r\n            const keymarker = i < 9 ? `(${i + 1}) ` : '';\r\n\r\n            $('#sfx-buttons').append($.parseHTML(`\r\n                <button class=\"sfx-button\" data-url=\"${sfx.url}\">\r\n                    <img class=\"play-icon\" src=\"./assets/play.png\">\r\n                    <p>${keymarker}${sfx.name}</p>\r\n                </button>\r\n            `));\r\n        }\r\n    });\r\n\r\n    api.onLoadPreviousText((previousText) => {\r\n        console.log(previousText);\r\n\r\n        previousText = JSON.parse(previousText);\r\n\r\n        for (const [key, value] of Object.entries(previousText)) {\r\n            let $elements = $(`#${key}`);\r\n\r\n            if ($elements.length === 0) {\r\n                details.add({ key });\r\n            }\r\n\r\n            $(`#${key}`).val(value);\r\n        }\r\n    });\r\n\r\n    // request media files\r\n    api.sendMessage('getFiles');\r\n    document.getElementsByClassName('header-tab')[0].click();\r\n}\r\n\r\nwindow.onload = _ => {\r\n    init();\r\n}"],"names":["audio","_","player","cancelTimeoutId","_public","src","stop","clearTimeout","Howl","play","console","log","fade","setTimeout","details","result","$","each","index","element","attr","val","api","sendMessage","JSON","stringify","key","parseInt","substring","before","parseHTML","window","onload","async","document","on","event","hide","removeClass","$target","target","show","addClass","type","cancel","currentTarget","parent","siblings","sibling","length","add","closest","remove","num","isNaN","eq","update","onListFiles","files","i","videos","video","append","url","name","images","image","sfx","keymarker","onLoadPreviousText","previousText","parse","value","Object","entries","getElementsByClassName","click","init"],"sourceRoot":""}